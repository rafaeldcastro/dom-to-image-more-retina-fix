/*! dom-to-image-retina-fix 08-06-2018 */
/*! dom-to-image-more 21-05-2019 */
(function(e){"use strict";function t(e,t){function n(e){return t.bgcolor&&(e.style.backgroundColor=t.bgcolor),t.width&&(e.style.width=t.width+"px"),t.height&&(e.style.height=t.height+"px"),t.style&&Object.keys(t.style).forEach(function(n){e.style[n]=t.style[n]}),e}return t=t||{},a(t),Promise.resolve(e).then(function(e){return s(e,t.filter,!0)}).then(l).then(f).then(n).then(function(n){return h(n,t.width||v.width(e),t.height||v.height(e))})}function n(e,t){return c(e,t||{}).then(function(t){return t.getContext("2d").getImageData(0,0,v.width(e),v.height(e)).data})}function r(e,t){return c(e,t||{}).then(function(e){return e.toDataURL()})}function o(e,t){return t=t||{},c(e,t).then(function(e){return e.toDataURL("image/jpeg",t.quality||1)})}function i(e,t){return c(e,t||{}).then(v.canvasToBlob)}function u(e,t){return c(e,t||{})}function a(e){void 0===e.imagePlaceholder?A.impl.options.imagePlaceholder=b.imagePlaceholder:A.impl.options.imagePlaceholder=e.imagePlaceholder,void 0===e.cacheBust?A.impl.options.cacheBust=b.cacheBust:A.impl.options.cacheBust=e.cacheBust,void 0===e.useCredentials?A.impl.options.useCredentials=b.useCredentials:A.impl.options.useCredentials=e.useCredentials}function c(e,n){function r(e,t){var r=document.createElement("canvas");if(r.width=(n.width||v.width(e))*t,r.height=(n.height||v.height(e))*t,r.style.width=v.width(e),r.style.height=v.height(e),n.bgcolor){var o=r.getContext("2d");o.fillStyle=n.bgcolor,o.fillRect(0,0,r.width,r.height)}return r}return t(e,n).then(v.makeImage).then(v.delay(100)).then(function(t){var o="number"!=typeof n.scale?1:n.scale,i=r(e,o),u=i.getContext("2d");return t&&(u.scale(o,o),u.drawImage(t,0,0)),i})}function s(e,t,n){function r(e){return e instanceof HTMLCanvasElement?v.makeImage(e.toDataURL()):e.cloneNode(!1)}function o(e,t,n){function r(e,t,n){var r=Promise.resolve();return t.forEach(function(t){r=r.then(function(){return s(t,n)}).then(function(t){t&&e.appendChild(t)})}),r}var o=e.childNodes;return 0===o.length?Promise.resolve(t):r(t,v.asArray(o),n).then(function(){return t})}function i(e,t){function n(){function n(e,t){function n(e,t){v.asArray(e).forEach(function(n){t.setProperty(n,e.getPropertyValue(n),e.getPropertyPriority(n))})}e.cssText?(t.cssText=e.cssText,t.font=e.font):n(e,t)}n(window.getComputedStyle(e),t.style)}function r(){function n(n){function r(e,t,n){function r(e){var t=e.getPropertyValue("content");return e.cssText+" content: "+t+";"}function o(e){function t(t){return t+": "+e.getPropertyValue(t)+(e.getPropertyPriority(t)?" !important":"")}return v.asArray(e).map(t).join("; ")+";"}var i="."+e+":"+t,u=n.cssText?r(n):o(n);return document.createTextNode(i+"{"+u+"}")}var o=window.getComputedStyle(e,n),i=o.getPropertyValue("content");if(""!==i&&"none"!==i){var u=v.uid(),a=t.getAttribute("class");a&&t.setAttribute("class",a+" "+u);var c=document.createElement("style");c.appendChild(r(u,n,o)),t.appendChild(c)}}[":before",":after"].forEach(function(e){n(e)})}function o(){e instanceof HTMLTextAreaElement&&(t.innerHTML=e.value),e instanceof HTMLInputElement&&t.setAttribute("value",e.value)}function i(){t instanceof SVGElement&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t instanceof SVGRectElement&&["width","height"].forEach(function(e){var n=t.getAttribute(e);n&&t.style.setProperty(e,n)}))}return t instanceof Element?Promise.resolve().then(n).then(r).then(o).then(i).then(function(){return t}):t}return n||!t||t(e)?Promise.resolve(e).then(r).then(function(n){return o(e,n,t)}).then(function(t){return i(e,t)}):Promise.resolve()}function l(e){return w.resolveAll().then(function(t){var n=document.createElement("style");return e.appendChild(n),n.appendChild(document.createTextNode(t)),e})}function f(e){return P.inlineAll(e).then(function(){return e})}function h(e,t,n){return Promise.resolve(e).then(function(e){return e.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(e)}).then(v.escapeXhtml).then(function(e){return'<foreignObject x="0" y="0" width="100%" height="100%">'+e+"</foreignObject>"}).then(function(e){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+t+'" height="'+n+'">'+e+"</svg>"}).then(function(e){return"data:image/svg+xml;charset=utf-8,"+e})}function d(){function e(){var e="application/font-woff",t="image/jpeg";return{woff:e,woff2:e,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:t,jpeg:t,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function t(e){var t=/\.([^\.\/]*?)(\?|$)/g.exec(e);return t?t[1]:""}function n(n){var r=t(n).toLowerCase();return e()[r]||""}function r(e){return-1!==e.search(/^(data:)/)}function o(e){return new Promise(function(t){for(var n=window.atob(e.toDataURL().split(",")[1]),r=n.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=n.charCodeAt(i);t(new Blob([o],{type:"image/png"}))})}function i(e){return e.toBlob?new Promise(function(t){e.toBlob(t)}):o(e)}function u(e,t){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");return n.body.appendChild(o),r.href=t,o.href=e,o.href}function a(){var e=0;return function(){function t(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}return"u"+t()+e++}}function c(e){return"data:,"===e?Promise.resolve():new Promise(function(t,n){var r=new Image;A.impl.options.useCredentials&&(r.crossOrigin="use-credentials"),r.onload=function(){t(r)},r.onerror=n,r.src=e})}function s(e){var t=3e4;return A.impl.options.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime()),new Promise(function(n){function r(){if(4===a.readyState)if(200===a.status){var t=new FileReader;t.onloadend=function(){var e=t.result.split(/,/)[1];n(e)},t.readAsDataURL(a.response)}else u?n(u):i("cannot fetch resource: "+e+", status: "+a.status)}function o(){u?n(u):i("timeout of "+t+"ms occured while fetching resource: "+e)}function i(e){console.error(e),n("")}var u,a=new XMLHttpRequest;if(a.onreadystatechange=r,a.ontimeout=o,a.responseType="blob",a.timeout=t,A.impl.options.useCredentials&&(a.withCredentials=!0),a.open("GET",e,!0),a.send(),A.impl.options.imagePlaceholder){var c=A.impl.options.imagePlaceholder.split(/,/);c&&c[1]&&(u=c[1])}})}function l(e,t){return"data:"+t+";base64,"+e}function f(e){return e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function h(e){return function(t){return new Promise(function(n){setTimeout(function(){n(t)},e)})}}function d(e){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}function m(e){return e.replace(/#/g,"%23").replace(/\n/g,"%0A")}function p(e){var t=v(e,"border-left-width"),n=v(e,"border-right-width");return e.scrollWidth+t+n}function g(e){var t=v(e,"border-top-width"),n=v(e,"border-bottom-width");return e.scrollHeight+t+n}function v(e,t){var n=window.getComputedStyle(e).getPropertyValue(t);return parseFloat(n.replace("px",""))}return{escape:f,parseExtension:t,mimeType:n,dataAsUrl:l,isDataUrl:r,canvasToBlob:i,resolveUrl:u,getAndEncode:s,uid:a(),delay:h,asArray:d,escapeXhtml:m,makeImage:c,width:p,height:g}}function m(){function e(e){return-1!==e.search(o)}function t(e){for(var t,n=[];null!==(t=o.exec(e));)n.push(t[1]);return n.filter(function(e){return!v.isDataUrl(e)})}function n(e,t,n,r){function o(e){return new RegExp("(url\\(['\"]?)("+v.escape(e)+")(['\"]?\\))","g")}return Promise.resolve(t).then(function(e){return n?v.resolveUrl(e,n):e}).then(r||v.getAndEncode).then(function(e){return v.dataAsUrl(e,v.mimeType(t))}).then(function(n){return e.replace(o(t),"$1"+n+"$3")})}function r(r,o,i){function u(){return!e(r)}return u()?Promise.resolve(r):Promise.resolve(r).then(t).then(function(e){var t=Promise.resolve(r);return e.forEach(function(e){t=t.then(function(t){return n(t,e,o,i)})}),t})}var o=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:r,shouldProcess:e,impl:{readUrls:t,inline:n}}}function p(){function e(){return t(document).then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join("\n")})}function t(){function e(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return y.shouldProcess(e.style.getPropertyValue("src"))})}function t(e){var t=[];return e.forEach(function(e){if(e.hasOwnProperty("cssRules"))try{v.asArray(e.cssRules||[]).forEach(t.push.bind(t))}catch(t){console.log("Error while reading CSS rules from "+e.href,t.toString())}}),t}function n(e){return{resolve:function(){var t=(e.parentStyleSheet||{}).href;return y.inlineAll(e.cssText,t)},src:function(){return e.style.getPropertyValue("src")}}}return Promise.resolve(v.asArray(document.styleSheets)).then(t).then(e).then(function(e){return e.map(n)})}return{resolveAll:e,impl:{readAll:t}}}function g(){function e(e){function t(t){return v.isDataUrl(e.src)?Promise.resolve():Promise.resolve(e.src).then(t||v.getAndEncode).then(function(t){return v.dataAsUrl(t,v.mimeType(e.src))}).then(function(t){return new Promise(function(n,r){e.onload=n,e.onerror=r,e.src=t})})}return{inline:t}}function t(n){function r(e){var t=e.style.getPropertyValue("background");return t?y.inlineAll(t).then(function(t){e.style.setProperty("background",t,e.style.getPropertyPriority("background"))}).then(function(){return e}):Promise.resolve(e)}return n instanceof Element?r(n).then(function(){return n instanceof HTMLImageElement?e(n).inline():Promise.all(v.asArray(n.childNodes).map(function(e){return t(e)}))}):Promise.resolve(n)}return{inlineAll:t,impl:{newImage:e}}}var v=d(),y=m(),w=p(),P=g(),b={imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1},A={toSvg:t,toPng:r,toJpeg:o,toBlob:i,toPixelData:n,toCanvas:u,impl:{fontFaces:w,images:P,util:v,inliner:y,options:{}}};"object"==typeof exports&&"object"==typeof module?module.exports=A:e.domtoimage=A})(this);
